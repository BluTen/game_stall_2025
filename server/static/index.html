<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leader Board</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Twinkle+Star&display=swap');

        * {
            box-sizing: border-box;
        }

        :root {
            --bg: #eef0f1;
            /* soft grey background */
            --card: #ffffff;
            --muted: #6b7280;
            --green: #2f855a;
            /* green accent */
            --yellow: #fc0;
            /* yellow accent */
            --soft-red: #c83737;
            /* main soft red */
            --glass: rgba(255, 255, 255, 0.6);
            --radius: 12px;
            --shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
            font-family: Outfit, sans-serif;
            font-size: 16px;
        }

        input {
            all: unset;
            width: 100%;
            font-size: 1em;
        }

        svg {
            display: block;
        }

        html,
        body {
            /* height: 100%; */
            width: 100%;
            margin: 0;
            background: var(--green);
            color: #333;
        }

        .body {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: min(90%, 700px);
            /* height: 100%; */
            padding: 1em 2em 2em;
            border-radius: 0 0 1em 1em;
            margin: auto;
            background-color: var(--bg);
        }

        .header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
        }

        .header>svg {
            height: 50px;
        }

        .control-panel {
            width: 100%;
            display: flex;
            gap: 16px;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .box {
            background: var(--card);
            padding: 8px 16px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);

            /* ensure consistent height and center contents */
            display: flex;
            align-items: center;
            gap: 8px;
            /* min-height: 40px; */
        }

        .search-bar {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .button {
            cursor: pointer;
            background-color: var(--soft-red);
        }

        .button * {
            cursor: pointer;
        }

        #loading-label {
            margin: 0;
            margin: 5em auto;
            font-weight: normal;
            color: var(--muted);
        }

        .leaderboard {
            width: 100%;
            font-size: 1.1em;
        }

        .leaderboard table {
            display: none;
            width: 100%;
            border-spacing: 0 .5em;
            text-align: center;
        }

        .leaderboard th {
            padding: 0 0 .5em;
            font-size: 1.3em;
        }

        .leaderboard tbody tr:nth-child(1) td {
            background-color: #ffec83;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr:nth-child(2) td {
            background-color: #c0c0c0;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr:nth-child(3) td {
            background-color: #ff9b61;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr td:first-child {
            border-radius: 5px 0 0 5px;
        }

        .leaderboard tbody tr td:last-child {
            border-radius: 0 5px 5px 0;
        }

        @media (max-width: 600px) {
            :root {
                font-size: 14px;
            }
            .body {
                /* width: 90%; */
                padding: 1em;
            }
            
        }
    </style>
</head>

<body>
    <div id="leaderboard-screen" class="body">
        <div class="header">
            <!-- Hard coded the svg cause its a static html file running serverless -->
            <svg version="1.1" viewBox="0 0 113.48684 19.514256" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="m6.98385 3.31051e-6h2.96826c0.90949 0 1.64109 0.731658689 1.64109 1.63970669v1.04739c0 0.90805-0.7316 1.63971-1.64109 1.63971h-2.96826c-0.90946 0-1.64288-0.73166-1.64288-1.63971v-1.04739c0-0.908048 0.73342-1.63970669 1.64288-1.63970669z"
                    fill="#fc0" />
                <g fill="#c83737">
                    <path
                        d="m109.379 18.2368-3.881-5.745 3.857-5.33573h3.904l-4.656 5.99723 0.113-1.4372 4.77 6.5207zm-7.1 0v-16.55299h3.493v16.55299z" />
                    <path
                        d="m96.3217 18.4876c-1.1409 0-2.176-0.2508-3.1034-0.7525-0.9289-0.5016-1.6591-1.1934-2.1911-2.0739-0.5334-0.882-0.7994-1.8701-0.7994-2.9641 0-1.1109 0.266-2.0986 0.7994-2.96399 0.5472-0.88195 1.2859-1.57374 2.2133-2.07539 0.9285-0.50165 1.9703-0.75247 3.1267-0.75247 0.8682 0 1.6591 0.15169 2.3742 0.45614 0.7306 0.28928 1.3766 0.72884 1.9406 1.32291l-2.237 2.2338c-0.2589-0.2879-0.5634-0.5017-0.9133-0.6382-0.3351-0.1362-0.7221-0.2053-1.1645-0.2053-0.5017 0-0.9511 0.1146-1.3466 0.3418-0.3803 0.2138-0.6847 0.5169-0.9123 0.9123-0.2134 0.3803-0.3196 0.8283-0.3196 1.3452 0 0.5164 0.1062 0.9726 0.3196 1.368 0.2276 0.3958 0.5405 0.707 0.936 0.9345 0.3954 0.2286 0.8364 0.3419 1.3229 0.3419 0.4575 0 0.8597-0.0759 1.2096-0.2276 0.3655-0.1668 0.6781-0.3954 0.936-0.6833l2.2142 2.2338c-0.578 0.6075-1.2318 1.0721-1.962 1.3903-0.7306 0.3044-1.5448 0.4561-2.4433 0.4561z" />
                    <path
                        d="m85.0011 18.2368v-11.08073h3.4918v11.08073zm1.7568-12.60754c-0.5468 0-1.0044-0.18345-1.3695-0.54857-0.3499-0.37888-0.5253-0.83502-0.5253-1.36701 0-0.54716 0.1754-1.0033 0.5253-1.36842 0.3651-0.36512 0.8227-0.54716 1.3695-0.54716 0.5486 0 0.9966 0.18204 1.3465 0.54716 0.35 0.36512 0.525 0.82126 0.525 1.36842 0 0.53199-0.175 0.98813-0.525 1.36701-0.3499 0.36512-0.7979 0.54857-1.3465 0.54857z" />
                    <path d="m79.0437 1.68381h3.4918v16.55299h-3.4918z" />
                </g>
                <path
                    d="m65.8961 18.2368v-16.09685h3.5828v16.09685zm2.7393-6.3154v-3.0787h6.9056l1.3367 1.5392-1.3367 1.5395zm0-6.70277v-3.07868h8.4226v3.07868z"
                    fill="#333" />
                <g fill="#c83737">
                    <path
                        d="m55.8762 18.2368-3.8805-5.745 3.8572-5.33573h3.9028l-4.6567 5.99723 0.1147-1.4372 4.7706 6.5207zm-7.0996 0v-16.55299h3.4921v16.55299z" />
                    <path
                        d="m42.8196 18.4876c-1.1412 0-2.1759-0.2508-3.1048-0.7525-0.9274-0.5016-1.6577-1.1934-2.1911-2.0739-0.532-0.882-0.798-1.8701-0.798-2.9641 0-1.1109 0.266-2.0986 0.798-2.96399 0.5486-0.88195 1.2859-1.57374 2.2144-2.07539 0.9288-0.50165 1.9706-0.75247 3.127-0.75247 0.8682 0 1.6591 0.15169 2.3742 0.45614 0.7302 0.28928 1.3765 0.72884 1.9403 1.32291l-2.2366 2.2338c-0.259-0.2879-0.5634-0.5017-0.9137-0.6382-0.3348-0.1362-0.7232-0.2053-1.1642-0.2053-0.5017 0-0.9511 0.1146-1.3466 0.3418-0.3802 0.2138-0.6847 0.5169-0.9136 0.9123-0.2121 0.3803-0.3182 0.8283-0.3182 1.3452 0 0.5164 0.1061 0.9726 0.3182 1.368 0.2289 0.3958 0.5404 0.707 0.9373 0.9345 0.3954 0.2286 0.8364 0.3419 1.3229 0.3419 0.4575 0 0.8597-0.0759 1.2097-0.2276 0.3651-0.1668 0.678-0.3954 0.9359-0.6833l2.2144 2.2338c-0.5789 0.6075-1.2333 1.0721-1.9636 1.3903-0.7306 0.3044-1.5434 0.4561-2.4419 0.4561z" />
                    <path
                        d="m31.499 18.2368v-11.08073h3.4918v11.08073zm1.7568-12.60754c-0.5482 0-1.0043-0.18345-1.3695-0.54857-0.3503-0.37888-0.5252-0.83502-0.5252-1.36701 0-0.54716 0.1749-1.0033 0.5252-1.36842 0.3652-0.36512 0.8213-0.54716 1.3695-0.54716 0.5472 0 0.9966 0.18204 1.3466 0.54716 0.3499 0.36512 0.5249 0.82126 0.5249 1.36842 0 0.53199-0.175 0.98813-0.5249 1.36701-0.35 0.36512-0.7994 0.54857-1.3466 0.54857z" />
                    <path
                        d="m24.1263 18.4876c-1.0195 0-1.9251-0.2053-2.7174-0.6145-0.7758-0.4258-1.3836-1.0033-1.8256-1.7336-0.441-0.7443-0.6615-1.5959-0.6615-2.5537v-6.42973h3.4918v6.38453c0 0.3803 0.0607 0.7066 0.1834 0.9797 0.1362 0.2741 0.3348 0.4865 0.5923 0.6392 0.2593 0.1517 0.5705 0.2276 0.937 0.2276 0.5168 0 0.9275-0.1599 1.2323-0.4784 0.3044-0.3348 0.4561-0.7909 0.4561-1.3681v-6.38453h3.4918v6.40643c0 0.973-0.2205 1.8327-0.6615 2.577-0.4409 0.7303-1.0502 1.3078-1.8259 1.7336-0.7758 0.4092-1.6743 0.6145-2.6928 0.6145z" />
                </g>
                <g fill="#fc0">
                    <path
                        d="m8.46798 3.42828c0.2727 0 0.49318 0.24272 0.49318 0.54575v2.27647c0 0.30197-0.22048 0.54574-0.49318 0.54574-0.27446 0-0.49353-0.24377-0.49353-0.54574v-2.27647c0-0.30303 0.21907-0.54575 0.49353-0.54575z" />
                    <path
                        d="m8.46798 13.5459c0.2727 0 0.49318 0.2441 0.49318 0.5472v2.275c0 0.3034-0.22048 0.5472-0.49318 0.5472-0.27446 0-0.49353-0.2438-0.49353-0.5472v-2.275c0-0.3031 0.21907-0.5472 0.49353-0.5472z" />
                    <path
                        d="m5.38789 10.0181c0 0.2731-0.24377 0.4922-0.54716 0.4922h-2.27787c-0.30304 0-0.54681-0.2191-0.54681-0.4922 0-0.27406 0.24377-0.49313 0.54681-0.49313h2.27787c0.30339 0 0.54716 0.21907 0.54716 0.49313z" />
                    <path
                        d="m14.9612 10.0181c0 0.2731-0.2438 0.4922-0.5472 0.4922h-2.2778c-0.3031 0-0.5472-0.2191-0.5472-0.4922 0-0.27406 0.2441-0.49313 0.5472-0.49313h2.2778c0.3034 0 0.5472 0.21907 0.5472 0.49313z" />
                </g>
                <path
                    d="m8.51349 18.5109c-1.20191 0-2.32056-0.2134-3.35561-0.6378-1.03505-0.4258-1.94027-1.0185-2.71603-1.7791-0.76093-0.7606-1.36171-1.6415-1.802683-2.6444-0.427212-1.0185-0.639230723-2.1138-0.639230723-3.284 0-1.18497 0.212018723-2.27928 0.639230723-3.28258 0.425803-1.00294 1.018463-1.87818 1.779053-2.62218 0.77717-0.76059 1.67428-1.34514 2.69415-1.75577 1.03505-0.4258 2.15264-0.63923 3.35561-0.63923 1.21673 0 2.33572 0.21343 3.35522 0.63923 1.0351 0.41063 1.9322 0.99518 2.6928 1.75577 0.7757 0.744 1.3783 1.62594 1.8041 2.64441 0.4258 1.0033 0.6392 2.09726 0.6392 3.28395 0 1.1699-0.2134 2.2638-0.6392 3.2823-0.4258 1.0033-1.0284 1.8852-1.8041 2.6458-0.7606 0.7444-1.6507 1.33-2.6705 1.7558-1.0199 0.4244-2.13045 0.6378-3.33201 0.6378zm7.19031 1.0033-6.49463-6.4865v-2.075h2.07683l6.4946 6.4861zm-7.23582-4.2637c0.97402 0 1.81752-0.2134 2.53262-0.6378 0.7154-0.4258 1.2707-1.0199 1.6675-1.779 0.4107-0.7762 0.616-1.6648 0.616-2.6681 0-0.75917-0.1143-1.44426-0.3433-2.05174-0.2272-0.623-0.5552-1.15499-0.981-1.59596-0.4258-0.45614-0.9356-0.79763-1.5297-1.02658-0.57747-0.24236-1.23187-0.36371-1.96212-0.36371-0.9592 0-1.79563 0.21202-2.51071 0.63782-0.71543 0.41098-1.27881 0.99518-1.6898 1.75577-0.39546 0.744-0.59372 1.62594-0.59372 2.6444 0 0.7606 0.1143 1.4524 0.34325 2.0754 0.2286 0.623 0.55527 1.1631 0.98107 1.6192 0.4258 0.4396 0.92886 0.7828 1.50601 1.0252 0.59407 0.2438 1.24847 0.3651 1.9639 0.3651z"
                    fill="#333" />
            </svg>
            <h1>Leaderboard</h1>
        </div>
        <div class="control-panel">
            <div class="search-bar box">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#333">
                    <path
                        d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
                </svg><input type="search" name="name-search" id="name-search" placeholder="Search by name ...">
            </div>
            <div class="button box">
                <label for="refresh"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#ddd">
                        <path
                            d="M160-160v-80h110l-16-14q-52-46-73-105t-21-119q0-111 66.5-197.5T400-790v84q-72 26-116 88.5T240-478q0 45 17 87.5t53 78.5l10 10v-98h80v240H160Zm400-10v-84q72-26 116-88.5T720-482q0-45-17-87.5T650-648l-10-10v98h-80v-240h240v80H690l16 14q49 49 71.5 106.5T800-482q0 111-66.5 197.5T560-170Z" />
                    </svg></label>
                <input type="button" id="refresh" onclick="location.reload()" style="display:none;">
            </div>
        </div>
        <div class="leaderboard box">
            <h6 id="loading-label"><i>Loading leaderboard. Real quick...</i></h6>
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th style="width: 3em">Rank</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th style="width: 3.5em">Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Leaderboard entries will be populated here -->
                </tbody>
            </table>
        </div>
</body>
<script>
    const search_dom = document.getElementById('name-search');
    const leaderboard_table = document.getElementById('leaderboard-table');
    const leaderboard_body = document.getElementById('leaderboard-body');
    const loading_label = document.getElementById('loading-label');
    var table_rows = leaderboard_body.getElementsByTagName('tr');

    search_dom.addEventListener('input', function () {
        const filter = search_dom.value.toLowerCase();

        for (let i = 0; i < table_rows.length; i++) {
            const name = table_rows[i].getElementsByTagName('td')[1];
            const cls = table_rows[i].getElementsByTagName('td')[2];
            if (name) {
                const test_str = name.textContent + cls.textContent;
                if (test_str.toLowerCase().indexOf(filter) > -1) {
                    table_rows[i].style.display = '';
                } else {
                    table_rows[i].style.display = 'none';
                }
            }
        }
    });

    // Dont even try hacking into my db, this is a public key with only read access anyway
    const SUPABASE_KEY = 'sb_publishable_teuh4LrgkMZABt88Q61P8A_NbHyCqes';

    async function fetchLeaderboard() {
        try {
            const res = await fetch(`https://onficegxsclrxpaejfzx.supabase.co/rest/v1/leaderboard?select=*&order=score.desc`, {
                headers: {
                    'apikey': SUPABASE_KEY,
                }
            });
            if (!res.ok) throw new Error(`Failed to fetch: ${res.status} ${res.statusText}`);
            const rows = await res.json();
            renderRows(rows);
            table_rows = leaderboard_body.getElementsByTagName('tr');
        } catch (err) {
            console.error(err);
        }
    }

    function renderRows(rows) {
        if (rows.length === 0) {
            loading_label.textContent = 'No one has played yet ðŸ˜¢';
            return;
        }

        // clear current rows
        leaderboard_body.innerHTML = '';
        loading_label.style.display = 'none';
        leaderboard_table.style.display = 'table';

        rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${i+1}</td>
                <td>${row.name}</td>
                <td>${row.class}</td>
                <td>${row.score}</td>
            `;
            leaderboard_body.appendChild(tr);
        });
    }

    // fetch once when the page is fully loaded and rendered
    window.addEventListener('load', fetchLeaderboard);
</script>

</html>