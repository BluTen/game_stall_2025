<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leader Board</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Twinkle+Star&display=swap');

        * {
            box-sizing: border-box;
        }

        :root {
            --bg: #eef0f1;
            /* soft grey background */
            --card: #ffffff;
            --muted: #6b7280;
            --green: #2f855a;
            /* green accent */
            --yellow: #fc0;
            /* yellow accent */
            --soft-red: #c83737;
            /* main soft red */
            --glass: rgba(255, 255, 255, 0.6);
            --radius: 12px;
            --shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
            font-family: Outfit, sans-serif;
            font-size: 16px;
        }

        input {
            all: unset;
            width: 100%;
            font-size: 1em;
        }

        svg {
            display: block;
        }

        html,
        body {
            /* height: 100%; */
            width: 100%;
            margin: 0;
            background: var(--green);
            color: #333;
        }

        .body {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: min(90%, 700px);
            /* height: 100%; */
            padding: 1em 2em 2em;
            border-radius: 0 0 1em 1em;
            margin: auto;
            background-color: var(--bg);
        }

        .header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
        }

        .header>img {
            height: 50px;
        }

        .control-panel {
            width: 100%;
            display: flex;
            gap: 16px;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .box {
            background: var(--card);
            padding: 8px 16px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);

            /* ensure consistent height and center contents */
            display: flex;
            align-items: center;
            gap: 8px;
            /* min-height: 40px; */
        }

        .search-bar {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .button {
            cursor: pointer;
            background-color: var(--soft-red);
        }

        .button * {
            cursor: pointer;
        }

        #loading-label {
            margin: 0;
            margin: 5em auto;
            font-weight: normal;
            color: var(--muted);
        }

        .leaderboard {
            width: 100%;
            font-size: 1.1em;
        }

        .leaderboard table {
            display: none;
            width: 100%;
            border-spacing: 0 .5em;
            text-align: center;
        }

        .leaderboard th {
            padding: 0 0 .5em;
            font-size: 1.3em;
        }

        .leaderboard tbody tr:nth-child(1) td {
            background-color: #ffec83;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr:nth-child(2) td {
            background-color: #c0c0c0;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr:nth-child(3) td {
            background-color: #ff9b61;
            font-weight: bold;
            font-size: 1.1em;
            padding-block: .1em;
        }

        .leaderboard tbody tr td:first-child {
            border-radius: 5px 0 0 5px;
        }

        .leaderboard tbody tr td:last-child {
            border-radius: 0 5px 5px 0;
        }

        @media (max-width: 600px) {
            :root {
                font-size: 14px;
            }
            .body {
                /* width: 90%; */
                padding: 1em;
            }
            
        }
    </style>
</head>

<body>
    <div id="leaderboard-screen" class="body">
        <div class="header">
            <img src="quick_flick.svg" alt="Quick Flick Logo">
            <h1>Leaderboard</h1>
        </div>
        <div class="control-panel">
            <div class="search-bar box">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#333">
                    <path
                        d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
                </svg><input type="search" name="name-search" id="name-search" placeholder="Search by name ...">
            </div>
            <div class="button box">
                <label for="refresh"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#ddd">
                        <path
                            d="M160-160v-80h110l-16-14q-52-46-73-105t-21-119q0-111 66.5-197.5T400-790v84q-72 26-116 88.5T240-478q0 45 17 87.5t53 78.5l10 10v-98h80v240H160Zm400-10v-84q72-26 116-88.5T720-482q0-45-17-87.5T650-648l-10-10v98h-80v-240h240v80H690l16 14q49 49 71.5 106.5T800-482q0 111-66.5 197.5T560-170Z" />
                    </svg></label>
                <input type="button" id="refresh" onclick="location.reload()" style="display:none;">
            </div>
        </div>
        <div class="leaderboard box">
            <h6 id="loading-label"><i>Loading leaderboard. Real quick...</i></h6>
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th style="width: 3em">Rank</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th style="width: 3.5em">Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Leaderboard entries will be populated here -->
                </tbody>
            </table>
        </div>
</body>
<script>
    const search_dom = document.getElementById('name-search');
    const leaderboard_table = document.getElementById('leaderboard-table');
    const leaderboard_body = document.getElementById('leaderboard-body');
    const loading_label = document.getElementById('loading-label');
    var table_rows = leaderboard_body.getElementsByTagName('tr');

    search_dom.addEventListener('input', function () {
        const filter = search_dom.value.toLowerCase();

        for (let i = 0; i < table_rows.length; i++) {
            const name = table_rows[i].getElementsByTagName('td')[1];
            const cls = table_rows[i].getElementsByTagName('td')[2];
            if (name) {
                const test_str = name.textContent + cls.textContent;
                if (test_str.toLowerCase().indexOf(filter) > -1) {
                    table_rows[i].style.display = '';
                } else {
                    table_rows[i].style.display = 'none';
                }
            }
        }
    });

    // Dont even try hacking into my db, this is a public key with only read access anyway
    const SUPABASE_KEY = 'sb_publishable_teuh4LrgkMZABt88Q61P8A_NbHyCqes';

    async function fetchLeaderboard() {
        try {
            const res = await fetch(`https://onficegxsclrxpaejfzx.supabase.co/rest/v1/leaderboard?select=*&order=score.desc`, {
                headers: {
                    'apikey': SUPABASE_KEY,
                }
            });
            if (!res.ok) throw new Error(`Failed to fetch: ${res.status} ${res.statusText}`);
            const rows = await res.json();
            renderRows(rows);
            table_rows = leaderboard_body.getElementsByTagName('tr');
        } catch (err) {
            console.error(err);
        }
    }

    function renderRows(rows) {
        if (rows.length === 0) {
            loading_label.textContent = 'No one has played yet ðŸ˜¢';
            return;
        }

        // clear current rows
        leaderboard_body.innerHTML = '';
        loading_label.style.display = 'none';
        leaderboard_table.style.display = 'table';

        rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${i+1}</td>
                <td>${row.name}</td>
                <td>${row.class}</td>
                <td>${row.score}</td>
            `;
            leaderboard_body.appendChild(tr);
        });
    }

    // fetch once when the page is fully loaded and rendered
    window.addEventListener('load', fetchLeaderboard);
</script>

</html>